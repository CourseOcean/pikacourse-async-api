asyncapi: 2.0.0
info:
  title: PikaCourse Async API
  version: 1.0.0
  description: PikaCourse Async API specs
servers:
  dev:
    url: test-homiehomie.thexyzlab.studio
    protocol: ws
    description: Development test server
  prod:
    url: pikacourse.com
    protocol: ws
    description: Production server
defaultContentType: application/json
tags:
  - name: chat
    description: Chat related async operation
channels:
  ws/chat/coursemeta/{coursemetaid}:
    description: Course chat API
    parameters:
      coursemetaid:
        description: Course Meta object id
        schema:
          type: integer
    subscribe:
      tags:
        - name: chat
      summary: Subscribe to a course for chat messages
      message:
        $ref: '#/components/messages/ChatRecMessage'
    publish:
      tags:
        - name: chat
      summary: Send message to a course chat room specified by `coursemetaid`
      message:
        $ref: '#/components/messages/ChatSendMessage'
  ws/chat/room/{roomid}:
    description: Generic chat API
    parameters:
      roomid:
        description: chat room object id
        schema:
          type: integer
    subscribe:
      tags:
        - name: chat
      summary: Subscribe to a room for chat messages
      message:
        $ref: '#/components/messages/ChatRecMessage'
    publish:
      tags:
        - name: chat
      summary: Send message to a chat room specified by `roomid`
      message:
        $ref: '#/components/messages/ChatSendMessage'
components:
  messages:
    ChatSendMessage:
      title: Course Chat publish message format
      summary: Message format used for sending a message to PikaCourse course chat 
      description: Send a message to the specific course chat room. Sender info will be injected in the backend
      payload:
        type: object
        properties:
          message:
            type: object
            $ref: '#/components/schemas/TextMessage'
    ChatRecMessage:
      title: Course chat subscribe messsage format
      summary: Message format used when receiving a message from PikaCourse course chat
      payload:
        type: object
        properties:
          id:
            type: integer
            description: Message id, ignored in `publish` action
          user:
            type: object
            description: Sender User info from send request auth
            $ref: '#/components/schemas/UserInfo'
          sender:
            type: boolean
            description: Is this message send by receiver
          room:
            type: object
            description: Chat room info
            $ref: '#/components/schemas/CourseInfo'
          message:
            type: object
            $ref: '#/components/schemas/TextMessage'
  schemas:
    UserInfo:
      type: object
      description: User info schema
      properties:
        id:
          type: integer
          description: User id
        username:
          type: string
        avatarUrl:
          type: string
          format: url
          description: User avatar image Url
    CourseInfo:
      type: object
      description: Course info schema
      properties:
        id:
          type: integer
          description: course meta object id
        title:
          type: string
          description: course title
          example: AAEC-2035
        school:
          type: string
          description: course university
          example: Purdue University
    TextMessage:
      type: object
      properties:
        text:
          type: string
          description: Message text content
          example: Hello World
        timestamp:
          type: string
          description: Time this message is created/produced, ignored in `publish` action
          format: date-time
          example: 1985-04-12T23:20:50.52Z

